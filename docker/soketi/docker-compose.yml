version: '3.8'

services:
  soketi:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: channel-engine-soketi
    restart: unless-stopped
    ports:
      - "${SOKETI_PORT:-6001}:6001"
    env_file:
      - ../../backend/.env
    environment:
      SOKETI_DEBUG: "${SOKETI_DEBUG:-1}"
      SOKETI_DEFAULT_APP_ID: ${PUSHER_APP_ID:-app-id}
      SOKETI_DEFAULT_APP_KEY: ${PUSHER_APP_KEY:-app-key}
      SOKETI_DEFAULT_APP_SECRET: ${PUSHER_APP_SECRET:-app-secret}
      SOKETI_DEFAULT_APP_ENABLE_CLIENT_MESSAGES: "true"
      SOKETI_DEFAULT_APP_ENABLE_STATS: "true"
    networks:
      - soketi_network
    healthcheck:
      test: ["CMD-SHELL", "nc -z localhost 6001 || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 5
    deploy:
      resources:
        limits:
          memory: 384M
          cpus: '0.5'
        reservations:
          memory: 256M
          cpus: '0.25'

networks:
  soketi_network:
    driver: bridge

